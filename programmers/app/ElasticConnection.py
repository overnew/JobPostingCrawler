from elasticsearch import Elasticsearch, helpers
import os

def uploadCsvToCloud():
  # Password for the 'elastic' user generated by Elasticsearch
  ELASTIC_PASSWORD = os.environ['ELASTIC_CLOUD_PASSWORD']

  # Found in the 'Manage Deployment' page
  CLOUD_ID = os.environ['ELASTIC_CLOUD_ID']

  # Create the client instance
  client = Elasticsearch(
    cloud_id=CLOUD_ID,
    basic_auth=("elastic", ELASTIC_PASSWORD)
  )

  #idx_name = "p1t-programmers_final_ver2"
  idx_name = "programmers_crawle_test"
  union_idx_name = "job_post_union_ver1"
  pipeline_name = "TATTOO_index_integrate_programmers"

  with open('data.ndjson', 'rt', encoding='UTF-8-sig') as f:
    helpers.bulk(client, f.readlines(), index=idx_name)

  print("upload complete!")

    #통합 인덱스에 업로드
  with open('data.ndjson', 'rt', encoding='UTF-8-sig') as f:
    helpers.bulk(client, f.readlines(), index=union_idx_name, pipeline=pipeline_name)
  print("union upload complete!")

#uploadCsvToCloud()

